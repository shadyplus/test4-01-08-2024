(function(b,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a():b.Blazy=a()})(this,function(){function s(f){var k=f._util;k.elements=g(f.options);k.count=k.elements.length;k.destroyed&&(k.destroyed=!1,f.options.container&&H(f.options.container,function(l){F(l,"scroll",k.validateT)}),F(window,"resize",k.saveViewportOffsetT),F(window,"resize",k.validateT),F(window,"scroll",k.validateT));G(f)}function G(f){for(var r=f._util,k=0;k<r.count;k++){var q=r.elements[k],n;k:{var l=q;n=f.options;var m=l.getBoundingClientRect();if(n.container&&b&&(l=l.closest(n.containerClass))){l=l.getBoundingClientRect();n=o(l,J)?o(m,{top:l.top-n.offset,right:l.right+n.offset,bottom:l.bottom+n.offset,left:l.left-n.offset}):!1;break k}n=o(m,J)}if(n||h(q,f.options.successClass)){f.load(q),r.elements.splice(k,1),r.count--,k--}}0===r.count&&f.destroy()}function o(f,k){return f.right>=k.left&&f.bottom>=k.top&&f.left<=k.right&&f.top<=k.bottom}function a(u,t,v){if(!h(u,v.successClass)&&(t||v.loadInvisible||0<u.offsetWidth&&0<u.offsetHeight)){if(t=u.getAttribute(e)||u.getAttribute(v.src)){t=t.split(v.separator);var r=t[w&&1<t.length?1:0],q=u.getAttribute(v.srcset),m="img"===u.nodeName.toLowerCase(),k=(t=u.parentNode)&&"picture"===t.nodeName.toLowerCase();if(m||void 0===u.src){var l=new Image,x=function(){v.error&&v.error(u,"invalid");d(u,v.errorClass);I(l,"error",x);I(l,"load",n)},n=function(){m?k||p(u,r,q):u.style.backgroundImage='url("'+r+'")';c(u,v);I(l,"load",n);I(l,"error",x)};k&&(l=u,H(t.getElementsByTagName("source"),function(f){var z=v.srcset,y=f.getAttribute(z);y&&(f.setAttribute("srcset",y),f.removeAttribute(z))}));F(l,"error",x);F(l,"load",n);p(l,r,q)}else{u.src=r,c(u,v)}}else{"video"===u.nodeName.toLowerCase()?(H(u.getElementsByTagName("source"),function(f){var z=v.src,y=f.getAttribute(z);y&&(f.setAttribute("src",y),f.removeAttribute(z))}),u.load(),c(u,v)):(v.error&&v.error(u,"missing"),d(u,v.errorClass))}}}function c(f,k){d(f,k.successClass);k.success&&k.success(f);f.removeAttribute(k.src);f.removeAttribute(k.srcset);H(k.breakpoints,function(l){f.removeAttribute(l.src)})}function p(f,l,k){k&&f.setAttribute("srcset",k);f.src=l}function h(f,k){return -1!==(" "+f.className+" ").indexOf(" "+k+" ")}function d(f,k){h(f,k)||(f.className+=" "+k)}function g(f){var l=[];f=f.root.querySelectorAll(f.selector);for(var k=f.length;k--;l.unshift(f[k])){}return l}function j(f){J.bottom=(window.innerHeight||document.documentElement.clientHeight)+f;J.right=(window.innerWidth||document.documentElement.clientWidth)+f}function F(f,l,k){f.attachEvent?f.attachEvent&&f.attachEvent("on"+l,k):f.addEventListener(l,k,{capture:!1,passive:!0})}function I(f,l,k){f.detachEvent?f.detachEvent&&f.detachEvent("on"+l,k):f.removeEventListener(l,k,{capture:!1,passive:!0})}function H(f,m){if(f&&m){for(var k=f.length,l=0;l<k&&!1!==m(f[l],l);l++){}}}function i(f,m,k){var l=0;return function(){var n=+new Date;n-l<m||(l=n,f.apply(k,arguments))}}var e,J,w,b;return function(f){if(!document.querySelectorAll){var m=document.createStyleSheet();document.querySelectorAll=function(q,n,u,r,t){t=document.all;n=[];q=q.replace(/\[for\b/gi,"[htmlFor").split(",");for(u=q.length;u--;){m.addRule(q[u],"k:v");for(r=t.length;r--;){t[r].currentStyle.k&&n.push(t[r])}m.removeRule(0)}return n}}var k=this,l=k._util={};l.elements=[];l.destroyed=!0;k.options=f||{};k.options.error=k.options.error||!1;k.options.offset=k.options.offset||100;k.options.root=k.options.root||document;k.options.success=k.options.success||!1;k.options.selector=k.options.selector||".b-lazy";k.options.separator=k.options.separator||"|";k.options.containerClass=k.options.container;k.options.container=k.options.containerClass?document.querySelectorAll(k.options.containerClass):!1;k.options.errorClass=k.options.errorClass||"b-error";k.options.breakpoints=k.options.breakpoints||!1;k.options.loadInvisible=k.options.loadInvisible||!1;k.options.successClass=k.options.successClass||"b-loaded";k.options.validateDelay=k.options.validateDelay||25;k.options.saveViewportOffsetDelay=k.options.saveViewportOffsetDelay||50;k.options.srcset=k.options.srcset||"data-srcset";k.options.src=e=k.options.src||"data-src";b=Element.prototype.closest;w=1<window.devicePixelRatio;J={};J.top=0-k.options.offset;J.left=0-k.options.offset;k.revalidate=function(){s(k)};k.load=function(q,n){var r=this.options;void 0===q.length?a(q,n,r):H(q,function(t){a(t,n,r)})};k.destroy=function(){var n=this._util;this.options.container&&H(this.options.container,function(q){I(q,"scroll",n.validateT)});I(window,"scroll",n.validateT);I(window,"resize",n.validateT);I(window,"resize",n.saveViewportOffsetT);n.count=0;n.elements.length=0;n.destroyed=!0};l.validateT=i(function(){G(k)},k.options.validateDelay,k);l.saveViewportOffsetT=i(function(){j(k.options.offset)},k.options.saveViewportOffsetDelay,k);j(k.options.offset);H(k.options.breakpoints,function(n){if(n.width>=window.screen.width){return e=n.src,!1}});setTimeout(function(){s(k)})}});